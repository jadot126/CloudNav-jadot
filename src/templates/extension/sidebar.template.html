<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <style>
        :root {
            /* 主主题 - Steam 风格暗蓝 */
            --bg: #071224;
            /* 主背景（深海军蓝） */
            --panel-bg: #0b2a3e;
            /* 面板背景，比主背景稍亮，用于卡片/输入等 */
            --text: #eaf6ff;
            /* 主文本色 - 浅蓝白 */
            --border: #153244;
            /* 边框色 */
            --hover: rgba(102, 192, 244, 0.06);
            /* hover 背景（微亮的蓝色半透明） */
            --selected: rgba(102, 192, 244, 0.12);
            /* 选中背景（强调） */
            --accent: #66c0f4;
            /* 亮蓝色高亮（Steam 风格） */
            --muted: #8eaab7;
            /* 次要文字/图标 */
            --folder: #8eaab7;
            /* 文件夹图标色 */

            /* 状态栏（Steam 风格暗蓝） */
            --status-bg: #0b3350;
            --status-bg-2: #041623;
            --status-text: #eaf6ff;
            --status-muted: rgba(234, 246, 255, 0.85);
            --status-accent: #66c0f4;
            --status-border: rgba(255, 255, 255, 0.06);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg: #041022;
                --panel-bg: #081726;
                --text: #eaf6ff;
                --border: #0e2a40;
                --hover: rgba(102, 192, 244, 0.05);
                --selected: rgba(102, 192, 244, 0.10);
                --accent: #66c0f4;
                --muted: #9fb7c8;
                --folder: #9fb7c8;

                /* 状态栏（暗色模式调整） */
                --status-bg: #051526;
                --status-bg-2: #02111a;
                --status-text: #eaf6ff;
                --status-muted: rgba(234, 246, 255, 0.9);
                --status-accent: #66c0f4;
                --status-border: rgba(255, 255, 255, 0.03);
            }
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: "Segoe UI", Roboto, Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            font-size: 13px;
            line-height: 1.4;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* 头部搜索栏 */
        .header {
            position: sticky;
            top: 0;
            padding: 8px;
            background: var(--panel-bg);
            border-bottom: 1px solid var(--border);
            z-index: 10;
            display: flex;
            gap: 6px;
        }

        .search-input {
            flex: 1;
            padding: 6px 10px;
            border-radius: 4px;
            border: 1px solid var(--border);
            background: var(--panel-bg);
            color: var(--text);
            outline: none;
            font-size: 13px;
        }

        .search-input:focus {
            border-color: var(--accent);
        }

        .icon-btn {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            background: transparent;
            border-radius: 4px;
            color: var(--muted);
            cursor: pointer;
        }

        .icon-btn:hover {
            background: var(--hover);
            color: var(--text);
        }

        .rotating {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            100% {
                transform: rotate(360deg);
            }
        }

        /* 书签树容器 */
        .tree {
            padding: 4px 0;
            flex: 1 1 auto;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        /* 树节点行 - 类似 Chrome 书签管理器 */
        .tree-row {
            display: flex;
            align-items: center;
            height: 28px;
            padding: 0 8px 0 4px;
            cursor: pointer;
            user-select: none;
            border-radius: 0;
            text-decoration: none;
            color: var(--text);
        }

        .tree-row:hover {
            background: var(--hover);
        }

        .tree-row.selected {
            background: var(--selected);
        }

        /* 展开/折叠箭头 */
        .tree-arrow {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            color: var(--muted);
            transition: transform 0.15s;
        }

        .tree-arrow svg {
            width: 12px;
            height: 12px;
        }

        .tree-arrow.expanded {
            transform: rotate(90deg);
        }

        .tree-arrow.hidden {
            visibility: hidden;
        }

        /* 图标 */
        .tree-icon {
            width: 16px;
            height: 16px;
            margin-right: 6px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tree-icon img {
            width: 16px;
            height: 16px;
            object-fit: contain;
        }

        .tree-icon svg {
            width: 16px;
            height: 16px;
            color: var(--folder);
        }

        /* 标题文字 */
        .tree-title {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 13px;
        }

        /* 子节点容器 */
        .tree-children {
            display: none;
        }

        .tree-children.expanded {
            display: block;
        }

        /* 缩进 */
        .indent-0 {
            padding-left: 4px;
        }

        .indent-1 {
            padding-left: 24px;
        }

        .indent-2 {
            padding-left: 44px;
        }

        .indent-3 {
            padding-left: 64px;
        }

        .indent-4 {
            padding-left: 84px;
        }

        .indent-5 {
            padding-left: 104px;
        }

        /* 链接数量标签 */
        .tree-count {
            font-size: 11px;
            color: var(--muted);
            margin-left: 6px;
            flex-shrink: 0;
        }

        /* 空状态和加载状态 */
        .empty {
            text-align: center;
            padding: 40px 20px;
            color: var(--muted);
            font-size: 13px;
        }

        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: var(--muted);
            font-size: 13px;
            gap: 12px;
        }

        .loading-spinner {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        /* 书签同步面板 */
        .sync-panel {
            display: none;
            padding: 12px;
            border-top: 1px solid var(--border);
            background: var(--hover);
        }

        .sync-panel.active {
            display: block;
        }

        .sync-panel h3 {
            margin: 0 0 10px 0;
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .sync-input {
            width: 100%;
            padding: 6px 8px;
            border-radius: 4px;
            border: 1px solid var(--border);
            background: var(--panel-bg);
            color: var(--text);
            outline: none;
            font-size: 12px;
            margin-bottom: 8px;
        }

        .sync-input:focus {
            border-color: var(--accent);
        }

        .sync-mode {
            display: flex;
            gap: 6px;
            margin-bottom: 10px;
        }

        .sync-mode-btn {
            flex: 1;
            padding: 6px;
            border-radius: 4px;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text);
            cursor: pointer;
            font-size: 11px;
            text-align: center;
            position: relative;
        }

        .sync-mode-btn:hover {
            border-color: var(--accent);
        }

        .sync-mode-btn.active {
            border-color: var(--accent);
            background: var(--accent);
            color: white;
        }

        .sync-mode-btn.danger.active {
            border-color: #dc3545;
            background: #dc3545;
        }

        /* Tooltip 样式（带边框和阴影） */
        .sync-mode-btn .tooltip {
            visibility: hidden;
            opacity: 0;
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background: var(--panel-bg);
            color: var(--text);
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 11px;
            white-space: nowrap;
            z-index: 100;
            transition: opacity 0.2s, visibility 0.2s;
            pointer-events: none;
            max-width: 200px;
            white-space: normal;
            text-align: left;
            line-height: 1.4;
            border: 1px solid var(--border);
            box-shadow: 0 6px 18px rgba(2, 6, 23, 0.65);
        }

        /* 箭头边框（外层三角） */
        .sync-mode-btn .tooltip::before {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(2px);
            border: 6px solid transparent;
            border-top-color: var(--border);
            z-index: 99;
        }

        /* 箭头内层（遮盖外层边框） */
        .sync-mode-btn .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: var(--panel-bg);
            z-index: 100;
        }

        .sync-mode-btn:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }

        .sync-actions {
            display: flex;
            gap: 6px;
        }

        .sync-btn {
            flex: 1;
            padding: 8px;
            border-radius: 4px;
            border: none;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .sync-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .sync-btn.upload {
            background: var(--accent);
            color: white;
        }

        .sync-btn.download {
            background: #34a853;
            color: white;
        }

        .sync-progress {
            margin-top: 8px;
            padding: 6px;
            background: var(--panel-bg);
            border-radius: 4px;
            font-size: 11px;
        }

        /* 设置面板 */
        .settings-section {
            margin-top: 12px;
            padding-top: 10px;
            border-top: 1px solid var(--border);
        }

        .settings-section h4 {
            margin: 0 0 8px 0;
            font-size: 12px;
            font-weight: 600;
            color: var(--muted);
        }

        .setting-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 12px;
        }

        .setting-row label {
            flex: 1;
        }

        .setting-row input[type="number"] {
            width: 60px;
            padding: 4px 6px;
            border-radius: 4px;
            border: 1px solid var(--border);
            background: var(--panel-bg);
            color: var(--text);
            text-align: center;
        }

        .setting-row input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .setting-row select {
            padding: 4px 6px;
            border-radius: 4px;
            border: 1px solid var(--border);
            background: var(--panel-bg);
            color: var(--text);
        }

        .auto-sync-status {
            font-size: 11px;
            color: var(--muted);
            margin-top: 4px;
        }

        .sync-progress-bar {
            height: 3px;
            background: var(--border);
            border-radius: 2px;
            margin-top: 4px;
            overflow: hidden;
        }

        .sync-progress-fill {
            height: 100%;
            background: var(--accent);
            transition: width 0.3s;
        }

        /* 状态栏（暗蓝 Steam 风格） */
        .status-bar {
            background: linear-gradient(180deg, var(--status-bg) 0%, var(--status-bg-2) 100%);
            color: var(--status-text);
            position: sticky;
            bottom: 0;
            padding: 8px 10px;
            border-top: 1px solid var(--status-border);
            z-index: 20;
        }

        .status-row {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }

        .status-row .status-text {
            font-size: 12px;
            color: var(--status-text);
        }

        .status-bar .icon-btn {
            width: 28px;
            height: 28px;
            padding: 0;
            color: var(--status-text);
        }

        .status-bar .icon-btn:hover {
            background: rgba(255, 255, 255, 0.03);
            color: var(--status-accent);
        }

        /* 确认弹窗 */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 100;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: var(--panel-bg);
            border-radius: 8px;
            padding: 16px;
            max-width: 300px;
            width: 100%;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .modal-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .modal-body {
            font-size: 12px;
            color: var(--muted);
            margin-bottom: 14px;
            line-height: 1.5;
        }

        .modal-warning {
            color: #dc3545;
            font-size: 11px;
            margin-top: 6px;
        }

        .modal-actions {
            display: flex;
            gap: 8px;
        }

        .modal-btn {
            flex: 1;
            padding: 8px;
            border-radius: 4px;
            border: none;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
        }

        .modal-btn.cancel {
            background: var(--hover);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .modal-btn.confirm {
            background: var(--accent);
            color: white;
        }

        .modal-btn.danger {
            background: #dc3545;
            color: white;
        }
    </style>
</head>

<body>
    <div class="header">
        <input type="text" id="search" class="search-input" placeholder="搜索书签..." autocomplete="off">
        <button id="syncToggle" class="icon-btn" title="书签同步">
            <!-- 使用注释中的齿轮图形，调整为 16x16 并使用 currentColor 以匹配主题颜色 -->
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024" fill="currentColor"
                aria-hidden="true">
                <path
                    d="M1072.147851 406.226367c-6.331285-33.456782-26.762037-55.073399-52.047135-55.073399-0.323417 0-0.651455 0.003081-0.830105 0.009241l-4.655674 0c-73.124722 0-132.618162-59.491899-132.618162-132.618162 0-23.731152 11.447443-50.336101 11.546009-50.565574 13.104573-29.498767 3.023185-65.672257-23.427755-84.127081l-1.601687-1.127342-134.400039-74.661726-1.700252-0.745401c-8.753836-3.805547-18.334698-5.735272-28.479231-5.735272-20.789593 0-41.235746 8.344174-54.683758 22.306575-14.741683 15.216028-65.622973 58.649474-104.721083 58.649474-39.450789 0-90.633935-44.286652-105.438762-59.784516-13.518857-14.247316-34.128258-22.753199-55.127302-22.753199-9.945862 0-19.354234 1.861961-27.958682 5.531982l-1.746455 0.74078-139.141957 76.431283-1.643269 1.139662c-26.537186 18.437884-36.675557 54.579032-23.584845 84.062398 0.115506 0.264895 11.579891 26.725075 11.579891 50.634877 0 73.126262-59.491899 132.618162-132.618162 132.618162l-4.581749 0c-0.318797-0.00616-0.636055-0.01078-0.951772-0.01078-25.260456 0-45.672728 21.618157-52.002472 55.0811-0.462025 2.453354-11.313456 60.622322-11.313456 106.117939 0 45.494078 10.85143 103.659965 11.314996 106.119479 6.334365 33.458322 26.758957 55.076479 52.036353 55.076479 0.320337 0 0.651455-0.00616 0.842426-0.012321l4.655674 0c73.126262 0 132.618162 59.491899 132.618162 132.616622 0 23.760413-11.444363 50.333021-11.546009 50.565574-13.093793 29.474125-3.041666 65.646075 23.395414 84.151722l1.569346 1.093459 131.838879 73.726895 1.675611 0.7377c8.750757 3.84251 18.305437 5.790715 28.397607 5.790715 21.082208 0 41.676209-8.706094 55.0888-23.290689 18.724339-20.347588 69.527086-62.362616 107.04815-62.362616 40.625872 0 92.72537 47.100385 107.759669 63.583903 13.441852 14.831008 34.176001 23.689571 55.470741 23.695731l0.00616 0c9.895039 0 19.27877-1.883523 27.893999-5.598205l1.711034-0.73924 136.659342-75.531873 1.617088-1.128882c26.492523-18.456365 36.601633-54.600594 23.538642-84.016195-0.115506-0.267974-11.595291-27.082374-11.595291-50.67646 0-73.124722 59.49344-132.616622 132.618162-132.616622l4.517066-0.00154c0.300316 0.00616 0.599092 0.009241 0.899409 0.009241 25.331299-0.00154 45.785153-21.619697 52.107197-55.054918 0.112426-0.589852 11.325776-59.507301 11.325776-106.14104C1083.464388 466.640776 1072.609877 408.67356 1072.147851 406.226367zM377.486862 945.656142l-115.32764-64.487932c5.082277-13.052211 15.437801-43.51815 15.437801-75.017486 0-109.382917-84.176364-199.816642-192.587488-208.134635-2.647404-15.427021-8.873963-54.967133-8.873963-85.667166 0-30.65691 6.223479-70.232445 8.869343-85.671786 108.415744-8.311832 192.592108-98.745557 192.592108-208.134635 0-31.416171-10.300081-61.797405-15.371577-74.854236l122.721583-67.40331c0.003081 0 0.00462 0.00154 0.007701 0.00154 4.423121 4.518606 22.121764 22.080182 46.558275 39.493911 39.929754 28.46229 77.952885 42.894416 113.014434 42.894416 34.716571 0 72.437845-14.151831 112.115025-42.06431 24.282503-17.07953 41.896442-34.302288 46.308782-38.74543 0.009241-0.00154 0.018481-0.00462 0.026182-0.00616l118.301542 65.726159c-5.077657 13.055291-15.416239 43.499669-15.416239 74.958962 0 109.389077 84.174824 199.822802 192.590568 208.134635 2.645865 15.462442 8.872423 55.107281 8.872423 85.671786 0 30.687711-6.223479 70.241685-8.869343 85.673326C890.042174 606.334084 805.86427 696.767809 805.86427 806.158426c0 31.450053 10.317022 61.851309 15.393138 74.903519l-119.783103 66.198965c-5.168521-5.490399-22.603811-23.363073-46.740005-41.288109-40.701336-30.224145-79.662378-45.549521-115.800446-45.549521-35.79155 0-74.458435 15.038919-114.927219 44.694774C400.22004 922.554885 382.666163 940.255068 377.486862 945.656142zM731.271848 511.646647c0-105.803762-86.081448-191.88059-191.888289-191.88059-105.803762 0-191.88059 86.076827-191.88059 191.88059 0 105.803762 86.076827 191.882129 191.88059 191.882129C645.19194 703.528777 731.271848 617.450409 731.271848 511.646647zM539.383558 395.903184c63.825696 0 115.751164 51.922387 115.751164 115.743463 0 63.825696-51.925468 115.751164-115.751164 115.751164-63.821076 0-115.743463-51.925468-115.743463-115.751164C423.640095 447.824031 475.562482 395.903184 539.383558 395.903184z" />
            </svg>
        </button>
        <!-- 刷新按钮已移至底部状态栏 -->
    </div>

    <div id="syncPanel" class="sync-panel">
        <h3>
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2">
                <path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20" />
            </svg>
            书签同步
        </h3>
        <select id="targetFolder" class="sync-input">
            <option value="">-- 选择网站文件夹 --</option>
        </select>
        <select id="browserFolder" class="sync-input">
            <option value="">-- 选择浏览器同步位置 --</option>
        </select>
        <div class="sync-mode">
            <button id="modeMerge" class="sync-mode-btn active">合并<span
                    class="tooltip">保留现有书签，仅添加新书签，不会删除已有内容</span></button>
            <button id="modeOverwrite" class="sync-mode-btn danger">覆盖<span
                    class="tooltip">清空目标位置的所有书签后重新同步，会删除已有内容</span></button>
        </div>
        <div class="sync-actions">
            <button id="uploadBtn" class="sync-btn upload">↑ 上传到网站</button>
            <button id="downloadBtn" class="sync-btn download">↓ 同步到浏览器</button>
        </div>
        <div id="syncProgress" class="sync-progress" style="display:none;">
            <span id="syncMessage">处理中...</span>
            <div class="sync-progress-bar">
                <div id="syncProgressFill" class="sync-progress-fill" style="width:0%"></div>
            </div>
        </div>

        <!-- 设置面板 -->
        <div class="settings-section">
            <h4>自动同步设置</h4>
            <div class="setting-row">
                <label>数据刷新间隔 (分钟)</label>
                <input type="number" id="refreshInterval" min="1" max="60" value="1">
            </div>
            <div class="setting-row">
                <label>自动上传书签</label>
                <input type="checkbox" id="autoSyncEnabled">
            </div>
            <div class="setting-row" id="autoSyncIntervalRow" style="display:none;">
                <label>上传间隔 (分钟)</label>
                <input type="number" id="autoSyncInterval" min="1" max="60" value="5">
            </div>
            <div id="autoSyncStatus" class="auto-sync-status"></div>
        </div>
    </div>

    <div id="content" class="tree">
        <div class="loading">
            <div class="loading-spinner"></div>
            <span>加载中...</span>
        </div>
    </div>

    <div class="status-bar" aria-hidden="false">
        <div class="status-row">
            <button id="refresh" class="icon-btn" title="刷新数据" aria-label="刷新数据">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" />
                    <path d="M21 3v5h-5" />
                    <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" />
                    <path d="M8 16H3v5" />
                </svg>
            </button>
            <div style="flex:1"></div>
            <span id="dataRefreshTime" class="status-text">上次数据刷新: —</span>
        </div>
        <div class="status-row">
            <span id="bookmarkSyncTime" class="status-text">上次书签同步: —</span>
        </div>
    </div>

    <div id="confirmModal" class="modal-overlay">
        <div class="modal-content">
            <div id="modalTitle" class="modal-title"></div>
            <div id="modalBody" class="modal-body"></div>
            <div class="modal-actions">
                <button id="modalCancel" class="modal-btn cancel">取消</button>
                <button id="modalConfirm" class="modal-btn confirm">确认</button>
            </div>
        </div>
    </div>

    <script src="sidebar.js"></script>
</body>

</html>